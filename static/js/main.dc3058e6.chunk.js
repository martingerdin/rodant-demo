(this.webpackJsonprodant=this.webpackJsonprodant||[]).push([[1],{108:function(e,t){},110:function(e,t){},119:function(e,t,n){},128:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(2),c=n(0),i=n.n(c),s=n(64),l=n.n(s),u=n(12),d=n(4),p=(n(76),n(77),n(78),n(5)),f=n(3),m=n(21),h=n(22),v=n(24),b=n(23),g=n(29),y=n.n(g),k=(n(79),function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).inputRef=i.a.createRef(),a.resultsRef=i.a.createRef(),a.selectedRef=i.a.createRef(),a.state={selected:-1,matches:[]},a}return Object(h.a)(n,[{key:"componentDidUpdate",value:function(){this.selectedRef.current&&this.selectedRef.current.scrollIntoView({block:"nearest"})}},{key:"onKeyDown",value:function(e){if("ArrowUp"===e.key&&(this.setState({selected:Math.max(0,this.state.selected-1)}),e.preventDefault()),"ArrowDown"===e.key&&(this.setState({selected:Math.min(Math.min(this.maxResults,this.state.matches.length)-1,this.state.selected+1)}),e.preventDefault()),"Escape"===e.key&&(this.setState({matches:[]}),e.preventDefault()),"Enter"===e.key){var t=this.state.matches[this.state.selected];if(!t)return;var n=t[0];if(!n)return;e.target.value=n,this.props.onChange&&this.props.onChange(e,n),e.preventDefault()}}},{key:"onChange",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.inputRef.current.value.trim().toUpperCase(),this.props.onChange&&this.props.onChange(t),e.next=4,this.props.search(n);case 4:a=e.sent,this.setState({matches:a,selected:Math.min(this.state.selected,Math.min(a.length-1,this.maxResults))});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onFocus",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.onFocus&&this.props.onFocus(t),e.next=3,this.props.search(this.props.value);case 3:n=e.sent,this.setState({matches:n});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBlur",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onBlur&&this.props.onBlur(t),this.setState({matches:[]});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onClickRow",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.setState({selected:a}),this.props.onChange&&this.props.onChange(null,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.matches.slice(0,this.maxResults).map((function(t,n){return i.a.createElement("div",{ref:n===e.state.selected?e.selectedRef:null,className:["row",n===e.state.selected?"selected":""].filter(Boolean).join(" "),key:t[0],onMouseDown:function(a){return e.onClickRow(a,t[0],n)}},i.a.createElement("div",{className:"code"},t[0]),i.a.createElement("div",{className:"description"},t[1]))}));return i.a.createElement("div",{className:"autocomplete"},i.a.createElement("input",{ref:this.inputRef,className:"input is-small",type:"text",value:this.props.value,placeholder:this.props.placeholder,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.onChange(t)},onFocus:function(t){return e.onFocus(t)},onBlur:function(t){return e.onBlur(t)}}),t.length>0&&i.a.createElement("div",{className:"results",ref:this.resultsRef},t))}},{key:"maxResults",get:function(){return this.props.maxResults||30}}]),n}(i.a.Component));function E(){return(E=Object(o.a)(r.a.mark((function e(t){var a,o,c,i=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.length>1&&void 0!==i[1]?i[1]:[],!(t.length<1)){e.next=3;break}return e.abrupt("return",[]);case 3:return t=t.toUpperCase(),e.next=6,n.e(0).then(n.t.bind(null,129,3));case 6:if(o=e.sent,!((c=Object.keys(o).filter((function(e){return e.startsWith(t)&&(0===a.length||a.some((function(e){return e.startsWith(t)})))})).map((function(e){return[e,o[e]]}))).length>0)){e.next=10;break}return e.abrupt("return",c);case 10:if(!(t.length<3)){e.next=12;break}return e.abrupt("return",[]);case 12:return e.abrupt("return",Object.keys(o).filter((function(e){return o[e]&&-1!==o[e].toString().toUpperCase().indexOf(t)})).map((function(e){return[e,o[e]]})));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=function(e){return E.apply(this,arguments)};function O(e){return e.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map((function(e){return e.replace(/"/g,"")}))}var x=function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).state={record:a.props.record,value:(a.props.record[a.props.data.name]||"").toString(),showDescriptions:!1},a}return Object(h.a)(n,[{key:"componentDidUpdate",value:function(e){var t=(this.props.record[this.props.data.name]||"").toString();this.state.value!==t&&""===this.state.value&&this.setState({value:t})}},{key:"changeValueText",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onChange&&this.props.onChange(this.props.data,t.target.value),this.setState({value:t.target.value});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeValueSelect",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onChange&&this.props.onChange(this.props.data,t.target.value),this.setState({value:t.target.value});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeValueRadio",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onChange&&this.props.onChange(this.props.data,t),this.setState({value:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleDescriptions",value:function(e){this.setState({showDescriptions:!this.state.showDescriptions})}},{key:"getFieldClass",value:function(){return this.state.value===this.props.data.unknown?"default_value":this.props.validation.valid?"valid":"invalid"}},{key:"onFocus",value:function(){this.props.onFocus&&this.props.onFocus(this)}},{key:"onBlur",value:function(){this.props.onBlur&&this.props.onBlur(this)}},{key:"render",value:function(){var e=this,t=this.props.data,n=null,a=!0===this.props.unlabeled,r=a?null:i.a.createElement("label",{className:"label"},t.label);if("qualitative"===t.type&&"yes"===t.show_valid_values&&""!==t.valid_values&&""!==t.value_labels){var o=O(t.valid_values),c=O(t.value_labels);""!==t.unknown&&-1===o.indexOf(t.unknown.toString())&&(o.push(t.unknown),c.push("Unknown")),n=this.props.allowRadios&&o.length<=6?i.a.createElement("div",{className:"control radios"},c.map((function(n,a){return i.a.createElement("label",{className:"radio"+(e.state.value===o[a].toString()?" selected":""),key:o[a]},i.a.createElement("input",{id:"field_".concat(t.name),type:"radio",disabled:e.props.disabled,onFocus:function(t){return e.onFocus()},onBlur:function(t){return e.onBlur()},checked:e.state.value===o[a].toString(),onChange:function(t){return e.changeValueRadio(o[a].toString())}}),n)}))):i.a.createElement("div",{className:"select is-small is-light"},i.a.createElement("select",{id:"field_".concat(t.name),placeholder:a?t.label:"",value:this.state.value,disabled:this.props.disabled||"yes"!==t.input,onChange:function(t){return e.changeValueSelect(t)},onFocus:function(t){return e.onFocus()},onBlur:function(t){return e.onBlur()}},i.a.createElement("option",{key:"unset"}),o.map((function(e,t){return i.a.createElement("option",{key:e,value:e},e,". ",c[t])}))))}else"quantitative"===t.type?n=i.a.createElement("input",{id:"field_".concat(t.name),className:"input is-small",type:"number",disabled:"yes"!==t.input||this.props.disabled,placeholder:a?t.label:"",value:this.state.value,onChange:function(t){return e.changeValueText(t)},onFocus:function(t){return e.onFocus()},onBlur:function(t){return e.onBlur()}}):"icd10"===t.type?n=i.a.createElement(k,{value:this.state.value,disabled:this.props.disabled,placeholder:a?t.label:"",search:function(e){return w(e,t.valid_values.split(","))},onChange:function(t,n){n?(e.props.onChange&&e.props.onChange(e.props.data,n),e.setState({value:n})):e.changeValueText(t)},onFocus:function(t){return e.onFocus()},onBlur:function(t){return e.onBlur()}}):"icd"===t.name.substr(-3)||(n=i.a.createElement("input",{id:"field_".concat(t.name),className:"input is-small",disabled:"yes"!==t.input||this.props.disabled,type:"text",placeholder:a?t.label:"",value:this.state.value,onChange:function(t){return e.changeValueText(t)},onFocus:function(t){return e.onFocus()},onBlur:function(t){return e.onBlur()}}));var s=!0===this.props.showHelp?i.a.createElement("button",{className:"button is-small",onClick:function(){return e.toggleDescriptions()}},i.a.createElement("span",{className:"fa fa-question"})):null;return i.a.createElement("div",{className:"record_field "+this.getFieldClass(),onClick:function(e){return console.log(t)}},r,i.a.createElement("div",{className:"field has-addons"},i.a.createElement("div",{className:"control"},n),s),i.a.createElement("div",{className:this.state.showDescriptions?"descriptions show":"descriptions"},i.a.createElement("div",{className:"description"},t.description),i.a.createElement("div",{className:"coding_description"},t.coding_description)))}}]),n}(i.a.Component),j=n(13),N=n(7),S=n(17),C=n(35),F=n.n(C);function _(e,t){switch(t.type){case"quantitative":return function(e,t){if(!t.valid_values)return[];if(e.toString()===t.unknown||parseInt(e)===parseInt(t.unknown))return[];if("NaN"===e.toString())return["This field can not be empty"];var n=parseInt(e);if("NaN"===n.toString())return["Not a number"];var a=t.valid_values.split(",").map((function(e){return parseFloat(e)}));return n>=a[0]&&n<=a[1]?[]:["'".concat(e,"' is not in range ").concat(a[0]," .. ").concat(a[1])]}(e,t);case"qualitative":return function(e,t){return t.valid_values?""!==t.unknown&&e.toString()===t.unknown?[]:"NaN"===e.toString()?["This field can not be empty"]:-1!==t.valid_values.split(",").indexOf(e.toString())?[]:["'".concat(e,"' is not a valid value")]:[]}(e,t);case"date":return function(e,t){if(e===t.unknown)return[];if(void 0===e||""===e)return["'".concat(t.label,"' can not be empty")];var n,a=Object(p.a)(t.valid_values.split(","));try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e===r.trim())return[]}}catch(o){a.e(o)}finally{a.f()}return/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]$/.test(e)?F()(e).isValid()?[]:["'".concat(e,"' is not in a valid date")]:["'".concat(e,"' is not in correct format YYYY-MM-DD")]}(e,t);case"datetime":return function(e,t){return e===t.unknown?[]:void 0===e||""===e?["'".concat(t.label,"' can not be empty")]:/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9] [0-9][0-9]:[0-9][0-9]$/.test(e)?F()(e).isValid()?[]:["'".concat(e,"' is not a valid date or time")]:["'".concat(e,"' is not in correct format YYYY-MM-DD HH:mm")]}(e,t);case"time":return function(e,t){if(e===t.unknown)return[];var n,a=Object(p.a)(t.valid_values.split(","));try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e===r.trim())return[]}}catch(s){a.e(s)}finally{a.f()}if(void 0===e||""===e)return["'".concat(t.label,"' can not be empty")];if(!/^[0-9][0-9]:[0-9][0-9]$/.test(e))return["'".concat(e,"' is not in correct format HH:mm")];var o=e.split(":"),c=parseInt(o[0]),i=parseInt(o[1]);return c>=0&&c<24&&i>=0&&i<60?[]:["'".concat(e,"' is not a valid time")]}(e,t);case"text":return function(e,t){return e===t.unknown||void 0!==e&&e.length<=1e3?[]:["Text too long (< 1000 characters)"]}(e,t);case"icd10":return function(e,t){return e===t.unknown||void 0!==e&&-1!==t.valid_values.split(",").indexOf(e)?[]:["Unknown ICD10 code"]}(e,t);default:return[]}}function R(e,t){var n,a={moment:F.a},r=Object(p.a)(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;if("yes"!==o.calculated)switch(o.type){case"qualitative":case"quantitative":a[o.name]=parseInt(e[o.name]);break;case"icd10":a[o.name]=(e[o.name]||"").toString();break;default:a[o.name]=e[o.name]}}}catch(l){r.e(l)}finally{r.f()}var c,i=Object(p.a)(t);try{for(i.s();!(c=i.n()).done;){var s=c.value;"yes"===s.calculated&&function(){var e="return "+D(s.equation),t=new Function(e).bind(a);Object.defineProperty(a,s.name,{get:function(){return t()}})}()}}catch(l){i.e(l)}finally{i.f()}return a}function A(e,t){var n,a={},r=R(e,t),o=Object.assign.apply(Object,[{}].concat(Object(S.a)(Object(S.a)(t.entries()).map((function(e){var t=Object(N.a)(e,2),n=(t[0],t[1]);return Object(j.a)({},n.name,n)}))))),c=Object(p.a)(t);try{for(c.s();!(n=c.n()).done;){var i=n.value,s=_(r[i.name],i)||[],l=[];i.logic_checks&&function(){var e=U(i,r),n=JSON.parse("["+i.logic_prompts+"]"),a=i.logic_must_be_true.split(",").map((function(e){return"yes"===e.trim()})),o=function(r){"string"===typeof e[r]?s.push("'".concat((t.find((function(t){return t.name===e[r]}))||{}).label,"' can not be empty")):e[r]&&!0===a[r]?s.push(n[r]):!e[r]||!1!==a[r]&&void 0!==a[r]||l.push(n[r])};for(var c in e)o(c)}();var u=!1;""!==i.logic_checks&&(u=I(i,r)),"yes"!==i.calculated||u||(u=I(i,r));var d=!1;""!==i.valid_values&&(d=i.valid_values.split(",").includes(r[i.name]));var f=!1;""===i.logic_checks||"date"!==i.type&&"time"!==i.type&&"datetime"!==i.type||(f|=L(i,"logic_checks",r,o)),s=Object(S.a)(new Set(s));var m=u||f||d||0===s.length;m&&(s=[]),a[i.name]={value:r[i.name],valid:m,errors:s,warnings:l,unknown:u||M(r[i.name],i),incomplete:!r[i.name]&&0!==r[i.name],type:i.type}}}catch(h){c.e(h)}finally{c.f()}return a}var T=/([a-z_]+[0-9]*)/g;function D(e){return"$"===e[0]?e.substr(1):e.replace(T,"this.$1")}function L(e,t,n,a){var r=e[t];return null!==r&&r.trim().match(T).filter((function(e){return""!==a[e].valid_values})).map((function(e){return a[e].valid_values.split(",").includes(n[e])})).some((function(e){return!0===e}))}function I(e,t){return e.dependencies.map((function(e){return M(t[e.name],e)})).some((function(e){return!0===e}))}function U(e,t){return e.logic_checks.split(",").map((function(n){var a,r=n.trim().match(T),o=Object(p.a)(r);try{for(o.s();!(a=o.n()).done;){var c=a.value;if(void 0===t[c]||""===t[c])return c;if(t[c].toString()===(e.unknown||999).toString())return!1}}catch(i){o.e(i)}finally{o.f()}return new Function("return "+D(n.trim())).bind(t)()}))}function B(e){return Object.keys(e).every((function(t){return e[t].valid}))}function M(e,t){return!(!t.unknown||void 0===e||null===e)&&e.toString()===t.unknown}var P=n(34),q=n.n(P),V=function(e){var t=Object.keys(e.validation).filter((function(t){return(e.record[t]||"yes"===e.codebook.find((function(e){return e.name===t})).calculated)&&(!e.validation[t].valid||e.validation[t].warnings.length>0)&&!M(e.validation[t].value,t)})).map((function(t){return Object(f.a)(Object(f.a)({},e.validation[t]),{},{name:t,field:e.codebook.find((function(e){return e.name===t}))})})),n=y.a.groupBy(t,"field.group1"),a=Object.keys(n).map((function(t){return i.a.createElement("div",{key:t,className:"group"},i.a.createElement("div",{className:"group-name"},t),n[t].map((function(t){return i.a.createElement("div",{key:t.name,className:"field",onClick:function(){return e=t.name,void document.getElementById("field_".concat(e)).focus();var e}},i.a.createElement("div",{className:"field-name"},t.field.label),e.validation[t.name].errors.map((function(e,t){return i.a.createElement("div",{className:"issue error",key:"error ".concat(t)},i.a.createElement("span",{className:"fa fa-bug"}),i.a.createElement("div",{className:"description"},e))})),e.validation[t.name].warnings.map((function(e,t){return i.a.createElement("div",{className:"issue warning",key:"warning ".concat(t)},i.a.createElement("span",{className:"fa fa-warning"}),i.a.createElement("div",{className:"description"},e))})))})))}));return i.a.createElement("div",{className:"validation-container"},a)},z=0,G=1,W=2,H=3,Y=function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e){var a;Object(m.a)(this,n),a=t.call(this,e);for(var r={},o=0;o<e.codebook.length;o++)r[e.codebook[o].name]=e.codebook[o];return console.log(r),a.state={state:z,record:null,allowRadios:!1,doubleEntry:!!e["double-entry"],disableExitShield:!1},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({state:G,record:null}),e.next=3,this.props.db.records.where("uid").equals(Number(this.props.uid)).first();case 3:return t=e.sent,e.next=6,this.props.db.records.toArray();case 6:n=e.sent,a={state:t?H:W,pids:n.map((function(e){return e.pid}))},this.state.doubleEntry?(a.referenceRecord=Object(f.a)({},t),a.record={uid:this.props.uid},this.props.codebook.filter((function(e){return"yes"!==e.double_enter})).forEach((function(e){return a.record[e.name]=t[e.name]}))):a.record=t,this.setState(a);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updatePIDs",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t,n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.db.records.toArray();case 2:t=e.sent,this.setState({pids:t.map((function(e){return e[n.props.config.id_field]}))});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onChange",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=Object(f.a)({},this.state.record))[t.name]=n,this.setState({record:a}),!this.state.doubleEntry){e.next=5;break}return e.abrupt("return");case 5:return(o={})[t.name]=n,e.next=9,this.props.db.records.where("uid").equals(Number(this.props.uid)).modify(o);case 9:if(t.name!==this.props.config.id_field){e.next=12;break}return e.next=12,this.updatePIDs();case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onFocusFieldEditor",value:function(e){this.setState({state:this.state.state,record:this.state.record,focusedField:e})}},{key:"onBlurFieldEditor",value:function(e){this.setState({state:this.state.state,record:this.state.record,focusedField:null})}},{key:"saveAndExit",value:function(){var e=this;this.setState({disableExitShield:!0},(function(){e.props.history.push("/")}))}},{key:"exitWithoutSaving",value:function(){var e=this;this.setState({disableExitShield:!0},(function(){e.props.history.push("/")}))}},{key:"markFieldsUnknown",value:function(){var e,t=Object(f.a)({},this.state.record),n=Object(p.a)(this.props.codebook);try{for(n.s();!(e=n.n()).done;){var a=e.value;"yes"!==a.input||void 0!==t[a.name]&&""!==t[a.name]||(t[a.name]=a.unknown,this.onChange(a,a.unknown))}}catch(r){n.e(r)}finally{n.f()}this.setState({state:this.state.state,record:t,focusedField:null})}},{key:"unlockRecord",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=Object(f.a)({},this.state.record)).locked="FALSE",e.next=4,this.props.db.records.where("uid").equals(Number(this.props.uid)).modify({locked:!1});case 4:this.setState({record:t});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFieldGroup",value:function(e,t){var n=this;return this.state.doubleEntryErrors&&e.some((function(e){return-1!==n.state.doubleEntryErrors.indexOf(e.name)}))?"double-entry-error":e.some((function(e){return"yes"!==e.input}))?"valid":e.some((function(e){return t[e.name].unknown}))?"unknown":e.some((function(e){return t[e.name].incomplete}))?"incomplete":e.some((function(e){return!t[e.name].valid}))?"invalid":"valid"}},{key:"discard",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.records.where("uid").equals(n).delete();case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkDoubleEntry",value:function(){var e=this,t=this.props.codebook.filter((function(t){return"yes"===t.double_enter&&"yes"===t.input&&"yes"!==t.calculated&&e.state.referenceRecord[t.name]!==e.state.record[t.name]})).map((function(e){return e.name}));console.log(t),this.setState({doubleEntryErrors:t})}},{key:"handleClose",value:function(){Object.keys(this.state.record).includes(this.props.config.id_field)||this.props.db.records.where("uid").equals(this.state.record.uid).delete(),this.saveAndExit()}},{key:"finalizeDoubleEntry",value:function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.db.records.where("uid").equals(Number(this.props.uid)).modify({locked:!0});case 2:this.props.history.push("/");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(this.state.state===G)return i.a.createElement("div",{className:"content"},"Loading...");if(this.state.state===W)return i.a.createElement("div",{className:"content"},"Couldn't find record with id: ",this.props.uid);if(this.state.state===z)return i.a.createElement("div",{className:"content"},"Idle");var t=function(e){if("TRUE"===e)return!0;if("true"===e)return!0;if(!0===e)return!0;if("FALSE"===e)return!1;if("false"===e)return!1;if(!1===e)return!1;return!1}(this.state.record.locked);var n,a={},r=Object(p.a)(this.props.codebook);try{for(r.s();!(n=r.n()).done;){var o=n.value;a[o.name]=o}}catch(O){r.e(O)}finally{r.f()}var c=A(this.state.record,this.props.codebook),s=B(c);this.state.pids.filter((function(e){return parseInt(e)===parseInt(c.pid.value)})).length>1&&(c.pid.errors.push("Duplicate Patient study ID"),c.pid.valid=!1);var l=!this.state.disableExitShield&&(!s||this.state.doubleEntry&&t)?i.a.createElement(d.a,{message:function(t){if(e.state.doubleEntry)return"You have not yet completed this Double Entry. Discard changes?"}}):null,f=y.a.groupBy(this.props.codebook.filter((function(e){return"yes"===e.visible})),"group1"),m=Object.keys(f).map((function(n){var a=0,r=y.a.groupBy(f[n],(function(e){return""===e.group2?"_"+ ++a:e.group2})),o=Object.keys(r).map((function(n){var a="_"===n[0]?null:i.a.createElement("div",{className:"label"},n),o=r[n].map((function(n){return i.a.createElement(x,{key:n.name,data:n,disabled:t||e.state.doubleEntry&&"yes"!==n.double_enter,record:e.state.record,allowRadios:e.state.allowRadios,validation:c[n.name],unlabeled:""!==n.group2,onChange:function(t,n){return e.onChange(t,n)},onFocus:function(t){return e.onFocusFieldEditor(t)},onBlur:function(t){return e.onBlurFieldEditor(t)}})})),s=null!=e.state.focusedField&&null!=r[n].find((function(t){return t.name===e.state.focusedField.props.data.name}));return i.a.createElement("div",{className:["field_group",s?"focused":null,e.validateFieldGroup(r[n],c)].filter(Boolean).join(" "),key:n,onClick:function(){e.validateFieldGroup(r[n],c)}},a,o)}));return i.a.createElement("div",{className:"record_group",key:n},i.a.createElement("h2",null,n),i.a.createElement("div",{className:"fields"},o))})),h=s&&"1"===this.state.record.cr&&!this.state.doubleEntry&&!0!==t,v=this.state.focusedField?i.a.createElement("div",{className:"field_help visible"+(h||this.state.doubleEntry?" valid-record":"")},i.a.createElement("div",{className:"label"},this.state.focusedField.props.data.label),i.a.createElement("div",{className:"errors"},c[this.state.focusedField.props.data.name].errors.map((function(e,t){return i.a.createElement("div",{className:"error",key:t},e)}))),i.a.createElement("div",{className:"warnings"},c[this.state.focusedField.props.data.name].warnings.map((function(e,t){return i.a.createElement("div",{className:"warning",key:t},e)}))),i.a.createElement("div",{className:"description"},this.state.focusedField.props.data.description,"yes"===this.state.focusedField.props.data.show_valid_values?i.a.createElement("div",{className:"valid_values"},this.formatValid(this.state.focusedField.props.data)):null),i.a.createElement("div",{className:"coding_description",dangerouslySetInnerHTML:{__html:this.state.focusedField.props.data.coding_instructions}})):i.a.createElement("div",{className:"field_help"}),b=h?i.a.createElement("div",{className:"finalize-entry"},i.a.createElement(u.b,{to:"/complete/"+this.state.record.uid},i.a.createElement("button",{className:"button is-primary "},"Begin double entry"))):null,g=this.state.doubleEntry&&!0!==t?i.a.createElement("div",{className:"finalize-entry"},i.a.createElement("button",{className:"button is-primary ",onClick:function(){return e.checkDoubleEntry()}},"Check"),this.state.doubleEntryErrors&&0===this.state.doubleEntryErrors.length&&i.a.createElement("button",{className:"button is-primary ",onClick:function(){return e.finalizeDoubleEntry()}},"Finalize")):null,k=this.props.codebook.find((function(t){return t.name===e.props.config.id_field})),E=this.state.record[this.props.config.id_field],w=this.state.doubleEntry?"Double enter ".concat(k.label,": ").concat(E):"Editing ".concat(k.label,": ").concat(E);return t&&(w=i.a.createElement("span",null,i.a.createElement("span",{className:"fa fa-lock"})," Viewing locked ",k.label,": ",E)),i.a.createElement("div",{className:"editor"},i.a.createElement(q.a,null,i.a.createElement("title",null,"".concat(this.props.config.name," - ").concat(w))),i.a.createElement("div",{className:""},l,i.a.createElement("h1",null,w),i.a.createElement("div",{className:"toolbar"},!t&&(!this.state.doubleEntry||!0)&&i.a.createElement("button",{className:"button  save-and-exit",onClick:function(){e.handleClose()}},"Close record"),!t&&(!this.state.doubleEntry||!0)&&i.a.createElement("button",{className:"button  mark-unknown",onClick:function(){e.markFieldsUnknown()}},"Mark empty fields as Not Known"),t&&i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{className:"button  mark-unknown",onClick:function(){e.exitWithoutSaving()}},"Return"),i.a.createElement("button",{className:"button  mark-unknown",onClick:function(){e.unlockRecord()}},"Unlock")),i.a.createElement("div",{className:"control"},i.a.createElement("label",{className:"checkbox"},i.a.createElement("input",{type:"checkbox",value:this.props.allowRadios,onChange:function(t){return e.changeRadios(t)}})," ","[debug] Enable radio buttons"))),i.a.createElement("div",{className:"record_fields"},m),v,b,g),i.a.createElement("div",{className:"validation"},i.a.createElement(V,{record:this.state.record,codebook:this.props.codebook,validation:c})))}},{key:"changeRadios",value:function(e){this.setState({allowRadios:!this.state.allowRadios})}},{key:"formatValid",value:function(e){return"quantitative"===e.type?"Range: "+e.valid_values.split(",").join(" .. "):""}}]),n}(i.a.Component),$=Object(d.f)(Y),J=n(45),K=n.n(J);function Q(e){return'"'+e.toString().replace(/"/gi,'""').replace(/'/gi,"''")+'"'}function X(e,t){return new Promise((function(n){var a,r=[],o=r[0]=["uid"],c=Object(p.a)(e);try{for(c.s();!(a=c.n()).done;){var i=a.value;"yes"===i.input&&o.push(Q(i.name))}}catch(h){c.e(h)}finally{c.f()}o.push("valid"),o.push("locked");var s,l=Object(p.a)(t);try{var u=function(){var t,n=s.value,a=[n.uid],o=Object(p.a)(e);try{for(o.s();!(t=o.n()).done;){var c=t.value;"yes"===c.input&&a.push(Q(n[c.name]||""))}}catch(h){o.e(h)}finally{o.f()}var i=A(n,e),l=Object.keys(i).reduce((function(e,t){return e+i[t].errors.length}),0);a.push(0===l),a.push(n.locked),r.push(a)};for(l.s();!(s=l.n()).done;)u()}catch(h){l.e(h)}finally{l.f()}for(var d="",f=0,m=r;f<m.length;f++){d+=m[f].join(",")+"\n"}n(d)}))}function Z(e,t){return ee.apply(this,arguments)}function ee(){return(ee=Object(o.a)(r.a.mark((function e(t,n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise((function(e,a){K()(t,{delimiter:","},function(){var t=Object(o.a)(r.a.mark((function t(o,c){var i,s,l,u,d,f,m,h,v,b;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!o){t.next=4;break}a(o),t.next=14;break;case 4:i=c.splice(0,1)[0],s=[],l=Object(p.a)(c);try{for(l.s();!(u=l.n()).done;){for(d=u.value,f={},m=0;m<i.length;m++)h=i[m],"<unset>"!==(v=d[m])&&(f[h]="uid"===h?parseInt(v):v);s.push(f)}}catch(o){l.e(o)}finally{l.f()}return t.next=10,n.records.clear();case 10:return t.next=12,n.records.bulkPut(s);case 12:b=t.sent,e(b);case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())})),e.abrupt("return",a);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"data:application/octet-stream,",a=new Blob([e],{type:n}),r=URL.createObjectURL(a),o=document.createElement("A");o.setAttribute("href",r),o.setAttribute("download",t),o.click()};n(119);var ne=function(){return i.a.createElement("div",{className:"lds-spinner"},i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null))},ae=n(66);var re=function(e){var t=e.createRecord,n=e.cleanUpInvalidRecords,a=e.exportAndDownloadCSV,c=e.isLoading,s=e.setLoading,l=e.updateRecords,u=e.db;function d(e){return p.apply(this,arguments)}function p(){return(p=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),e.prev=1,console.log(t),e.next=5,Z(t,u);case 5:console.log(u),l(),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),console.log("error",e.t0),alert("Error when importing database: "+e.t0),s(!1);case 14:return e.abrupt("return",s(!1));case 15:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function f(){return(f=Object(o.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Importing may overwrite data. Continue?")){e.next=2;break}return e.abrupt("return");case 2:if(!t.text){e.next=9;break}return e.next=5,t.text();case 5:d(e.sent),e.next=12;break;case 9:(n=new FileReader).addEventListener("loadend",(function(e){d(e.srcElement.result)})),n.readAsText(t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return i.a.createElement("div",{className:"button-container"},i.a.createElement("div",{className:"buttons"},i.a.createElement("button",{className:"button is-primary ",onClick:t},"Create Record"),i.a.createElement("button",{className:"button ",onClick:n},"Delete invalid records"),i.a.createElement("button",{className:"button ",onClick:a},"Export as CSV"),i.a.createElement("div",{className:"fileUploader"},i.a.createElement(ae.FilePicker,{extensions:["csv"],maxSize:100,onChange:function(e){return function(e){return f.apply(this,arguments)}(e)},onError:function(e){console.log("Upload error",e),alert(e.toString())}},i.a.createElement("button",{className:"button "},"Import from CSV"))),c?i.a.createElement(ne,null):null))};function oe(e){var t=e.changeSearchText,n=e.onSearchFieldChanged,a=e.codebook,r=e.clearSearchText,o=e.search,c=e.searchField;return i.a.createElement("div",{className:"search"},i.a.createElement("span",{className:"fa fa-search"}),i.a.createElement("input",{className:"input is-primary",type:"text",value:o,onChange:function(e){return t(e)}}),i.a.createElement("div",{className:"select is-primary search-field"},i.a.createElement("select",{value:c,onChange:function(e){return n(e)}},i.a.createElement("option",{default:!0,value:"",key:"default"},"All fields"),null===a||void 0===a?void 0:a.map((function(e){return i.a.createElement("option",{value:e.name,key:e.name},e.label)})))),i.a.createElement("button",{className:"button ",onClick:function(){return r()}},i.a.createElement("span",{className:"fa fa-remove"})))}function ce(e){var t=e.filteredRecords,n=e.page,a=e.pageSize,r=e.codebook,o=e.searchHits,c=e.deleteRecord,s=e.sortField;function l(e){return e.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map((function(e){return e.replace(/"/g,"")}))}return t.slice(n*a,(n+1)*a).map((function(e){var t=A(e,r),n=Object.keys(t).filter((function(e){return!t[e].valid})).map((function(e){return[e,t[e]]})),a=null;n.length>0&&(a=i.a.createElement("span",{className:"issues"},i.a.createElement("span",{className:"fa fa-warning issues"}),i.a.createElement("span",null,n.length)));var d="true"===(e.locked||"").toString().toLowerCase();return i.a.createElement("div",{key:e.uid},i.a.createElement(u.b,{key:e.uid,to:"/record/"+e.uid,className:"list-item ".concat(d?" locked":"")},i.a.createElement("span",{className:"pid"},d&&i.a.createElement("span",{className:"fa fa-lock"}," ")," ",e.pid," ",a),i.a.createElement("span",{className:"hits"},o[e.uid]?o[e.uid].slice(0,10).map((function(e,t){return i.a.createElement("span",{key:t},e[0],": ",e[1])})):null),i.a.createElement("span",{className:"sort-field"},function(e,t,n){var a=e.find((function(e){return e.name===n}));if("qualitative"===a.type&&a.valid_values&&a.value_labels){var r=l(a.valid_values).map((function(e){return parseInt(e)})),o=l(a.value_labels),c=parseInt(t[n]);return o[r.find((function(e){return e.toString()===c.toString()}))]}return M(t[n]||"",a)?"unknown":t[n]}(r,e,s)),i.a.createElement("button",{disabled:"TRUE"===e.locked,onClick:function(t){t.preventDefault(),c(e.uid)},className:"button ".concat("TRUE"===e.locked?"is-disabled":" is-danger"," is-small is-outlined  remove")},i.a.createElement("span",{className:"fa fa-remove"}))))}))}var ie=function(e){var t=function(t){return"string"===typeof t?t:Math.max(1,Math.min(t,e.max))},n=Object(c.useState)(e.page+1),a=Object(N.a)(n,2),r=a[0],o=a[1];function s(n){n=t(n),o(n),e.onPageChange(n-1)}return r=t(r),i.a.createElement("div",{className:"paging"},i.a.createElement("button",{className:"button is-primary is-small",disabled:1===r,onClick:function(e){return s(r-1)}},"<"),i.a.createElement("input",{className:"input is-small is-primary",value:r,type:"text",onChange:function(e){return function(e){var t=parseInt(e.target.value);Number.isNaN(t)?o(""):s(t)}(e)},onFocus:function(e){return e.target.setSelectionRange(0,999)},onBlur:function(){return o(e.page+1)}}),i.a.createElement("span",null,"/"),i.a.createElement("span",null,e.max),i.a.createElement("button",{className:"button is-primary is-small",disabled:r===e.max,onClick:function(){return s(r+1)}},">"))};function se(e){var t=e.onSortFieldChanged,n=e.onSortOrderChanged,a=e.sortField,r=e.onPageChange,o=e.filteredRecords,c=e.pageSize,s=e.statePage,l=e.codebook,u=e.sortOrder,d=e.exactMatch,p=e.includeUnknown,f=e.includeLocked,m=e.onIncludeUnknownChanged,h=e.onIncludeLockedChanged,v=e.onExactMatchChanged,b=Math.ceil(o.length/c),g=Math.max(0,Math.min(s,b-1));return i.a.createElement("div",{className:"sort"},i.a.createElement(ie,{page:g,max:b,onPageChange:function(e){return r(e)}}),i.a.createElement("div",{className:"select is-primary sortField"},i.a.createElement("select",{className:"select",value:a,onChange:function(e){return t(e)}},l.map((function(e){return i.a.createElement("option",{value:e.name,key:e.name},e.label)})))),i.a.createElement("div",{className:"control"},i.a.createElement("input",{type:"checkbox",className:"checkbox",checked:1!==u,onChange:function(e){return n(e)},id:"Ascending"}),i.a.createElement("label",{htmlFor:"Ascending"}," Ascending")),i.a.createElement("div",{className:"control"},i.a.createElement("input",{type:"checkbox",className:"checkbox",checked:p,onChange:function(e){return m(e)},id:"Include unknown"}),i.a.createElement("label",{htmlFor:"Include unknown"}," Include unknown")),i.a.createElement("div",{className:"control"},i.a.createElement("input",{type:"checkbox",className:"checkbox",checked:f,onChange:function(e){return h(e)},id:"includeLocked"}),i.a.createElement("label",{htmlFor:"includeLocked"}," Include locked")),i.a.createElement("div",{className:"control"},i.a.createElement("input",{type:"checkbox",className:"checkbox",checked:d,onChange:function(e){return v(e)},id:"exactMatch"}),i.a.createElement("label",{htmlFor:"exactMatch"}," Exact match")))}var le=function(e,t){var n=Object(c.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return console.log(a),t}})),a=Object(N.a)(n,2),r=a[0],o=a[1],i=Object(c.useCallback)((function(t){try{var n=t instanceof Function?t(r):t;o(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(a){throw new Error("Error when attempting to useLocalState Hook: ".concat(a))}}),[e,r]);return Object(c.useEffect)((function(){window.localStorage.getItem(e)||i(t)}),[i,e,t]),[r,i]};var ue=Object(d.f)((function(e){var t=Object(c.useState)({records:[],search:"",searchField:"",pageSize:e.config.page_size,page:0}),n=Object(N.a)(t,2),a=n[0],s=n[1],l=le("recordPickerSortingState",{sortField:e.config.id_field,sortOrder:1,includeUnknown:!1,includeLocked:!0,exactMatch:!1}),u=Object(N.a)(l,2),d=u[0],m=u[1],h=Object(c.useReducer)((function(e,t){var n;switch(t.type){case"LOCALSTORAGE_STATE_UPDATE":return m(Object(f.a)(Object(f.a)({},e),{},Object(j.a)({},t.field,t.payload))),Object(f.a)(Object(f.a)({},e),{},(n={},Object(j.a)(n,t.field,t.payload),Object(j.a)(n,"page",0),n));case"PAGE_UPDATE":return m(Object(f.a)(Object(f.a)({},e),{},{page:t.payload}));default:throw new Error("Reducer Error when attempting to use this action: ".concat(t.type,",\n\t\t\t\t\t\t\t\t\t and this Payload: ").concat(t.payload))}}),d),v=Object(N.a)(h,2),b=v[0],g=v[1],y=Object(c.useState)(!1),k=Object(N.a)(y,2),E=k[0],w=k[1],O=Object(c.useState)([]),x=Object(N.a)(O,2),C=x[0],F=x[1],_=Object(c.useState)({}),T=Object(N.a)(_,2),D=T[0],L=T[1];Object(c.useEffect)((function(){U(),I()}),[]);var I=function(){var t=e.codebook.find((function(e){return e.name===b.sortField})).type;return g({type:"LOCALSTORAGE_STATE_UPDATE",field:"sortFieldType",payload:t})};function U(){return P.apply(this,arguments)}function P(){return(P=Object(o.a)(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.db.records.toArray();case 2:n=t.sent,s(Object(f.a)(Object(f.a)({},a),{},{records:n}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(){return(V=Object(o.a)(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.db.records.add({name:"Unnamed",locked:"FALSE"});case 2:n=t.sent,e.history.push("/record/"+n),U();case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(){return(z=Object(o.a)(r.a.mark((function t(n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.confirm("\ud83d\udca3 Delete record: ".concat(n,"?"))){t.next=4;break}return t.next=3,e.db.records.where("uid").equals(n).delete();case 3:U();case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function G(){return(G=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W(!0);case 2:setTimeout((function(){X(e.codebook,a.records.filter((function(e){return e}))).then((function(t){return te(t,"".concat(e.config.table,".csv"))})).catch((function(e){return console.error("there was an Error: ".concat(e))}))}),100),setTimeout((function(){W(!1)}),1500);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(e){return new Promise((function(t){t(w(e))}))}function H(){return(H=Object(o.a)(r.a.mark((function t(){var n,o,c,i,s,l,u,d,f=arguments;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=f.length>0&&void 0!==f[0]&&f[0],W(!0),o=Object(S.a)(a.records),c=[],i=Object(p.a)(o);try{for(i.s();!(s=i.n()).done;)l=s.value,u=A(l,e.codebook),"TRUE"===l.locked||B(u)||c.push(l.uid)}catch(r){i.e(r)}finally{i.f()}if(0!==c.length){t.next=10;break}n||alert("No invalid records to delete."),t.next=15;break;case 10:if(!n&&!window.confirm("Really delete "+c.length+" records?")){t.next=15;break}return t.next=13,(d=e.db.records.where("uid")).anyOf.apply(d,c).delete();case 13:U(),W(!1);case 15:W(!1);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Y={},$="";return $=a.sortField?e.codebook.find((function(e){return e.name===a.sortField})):"pid",Object(c.useEffect)((function(){!function(){var t=a.records.filter((function(t){if(!b.includeLocked&&"FALSE"!==t.locked)return!1;if(!b.includeUnknown&&M(t[b.sortField]||"",$))return!1;if(""===a.search)return L({}),!0;var n,r=R(t,e.codebook),o={},c=Object(p.a)(e.codebook);try{for(c.s();!(n=c.n()).done;){var i=n.value;o[i.name]=(r[i.name]||"").toString()}}catch(v){c.e(v)}finally{c.f()}var s,l=e.codebook.map((function(e){return e.name})).filter((function(e){return""===a.searchField||e===a.searchField})),u=!1,d=[],m=Object(p.a)(l);try{var h=function(){var t=s.value;if(o.hasOwnProperty(t)&&null!=o[t]&&(b.exactMatch?o[t].toString().toLowerCase()===a.search.trim():-1!==o[t].toString().toLowerCase().indexOf(a.search))){u=!0;var n=e.codebook.find((function(e){return e.name===t}));n&&d.push([n.label,r[t]])}};for(m.s();!(s=m.n()).done;)h()}catch(v){m.e(v)}finally{m.f()}return!!u&&(Y[t.uid]=d,L(Object(f.a)({},Y)),!0)})).sort((function(e,t){return"quantitative"===b.sortFieldType?(parseInt(e[b.sortField])-parseInt(t[b.sortField]))*-b.sortOrder:e[b.sortField]>t[b.sortField]?-b.sortOrder:e[b.sortField]===t[b.sortField]?0:b.sortOrder}));F(Object(S.a)(t))}()}),[a.records,a.search,a.searchField,b]),i.a.createElement("div",null,i.a.createElement(q.a,null,i.a.createElement("title",null,"".concat(e.config.name," - Records"))),i.a.createElement("h2",null,"Pick record"," ","(".concat(C.length," / ").concat(a.records.length,")")),i.a.createElement(re,{createRecord:function(){return V.apply(this,arguments)},cleanUpInvalidRecords:function(){return H.apply(this,arguments)},exportAndDownloadCSV:function(){return G.apply(this,arguments)},setLoading:W,updateRecords:U,db:e.db,isLoading:E}),i.a.createElement(oe,{changeSearchText:function(e){s(Object(f.a)(Object(f.a)({},a),{},{search:e.target.value,page:0}))},onSearchFieldChanged:function(e){s(Object(f.a)(Object(f.a)({},a),{},{searchField:e.target.value,page:0}))},codebook:a.codebook,clearSearchText:function(){s(Object(f.a)(Object(f.a)({},a),{},{search:"",page:0}))},search:a.search,searchField:a.searchField}),i.a.createElement(se,{pageSize:a.pageSize,statePage:a.page,filteredRecords:C,onPageChange:function(e){s(Object(f.a)(Object(f.a)({},a),{},{page:parseInt(e)}))},sortOrder:b.sortOrder,exactMatch:b.exactMatch,includeUnknown:b.includeUnknown,includeLocked:b.includeLocked,sortField:b.sortField,onSortFieldChanged:function(e){g({type:"LOCALSTORAGE_STATE_UPDATE",payload:e.target.value,field:"sortField"})},onSortOrderChanged:function(e){g({type:"LOCALSTORAGE_STATE_UPDATE",payload:e.target.checked?-1:1,field:"sortOrder"})},codebook:e.codebook,onIncludeUnknownChanged:function(e){g({type:"LOCALSTORAGE_STATE_UPDATE",payload:e.target.checked,field:"includeUnknown"})},onIncludeLockedChanged:function(e){g({type:"LOCALSTORAGE_STATE_UPDATE",payload:e.target.checked,field:"includeLocked"})},onExactMatchChanged:function(e){g({type:"LOCALSTORAGE_STATE_UPDATE",payload:e.target.checked,field:"exactMatch"})}}),i.a.createElement("div",{className:"list is-hoverable"},C?i.a.createElement(ce,{pageSize:a.pageSize,page:a.page,codebook:e.codebook,filteredRecords:C,searchHits:D,deleteRecord:function(e){return z.apply(this,arguments)},sortField:b.sortField}):null))})),de=n(67);var pe=function(e){var t=e.name,n=e.version,a=function(){var e=Object(c.useState)("light"),t=Object(N.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(!1),o=Object(N.a)(r,2),i=o[0],s=o[1],l=function(e){window.localStorage.setItem("theme",e),a(e)};return Object(c.useEffect)((function(){"dark"===n&&i?(document.querySelector("body").setAttribute("class","dark-theme"),document.querySelectorAll("button").forEach((function(e){e.className.includes("button ")&&e.setAttribute("class","button  is-dark")}))):(document.querySelector("body").setAttribute("class","light-theme"),document.querySelectorAll("button").forEach((function(e){e.className.includes("button ")&&e.setAttribute("class","button ")})))}),[n,i]),Object(c.useEffect)((function(){var e=window.localStorage.getItem("theme");window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&!e?l("dark"):e?a(e):l("light"),s(!0)}),[]),{theme:n,toggleTheme:function(){l("light"===n?"dark":"light")},componentMounted:i}}(),r=a.theme,o=a.toggleTheme,s=a.componentMounted,l=function(){return"light"===r?i.a.createElement("div",{style:{paddingLeft:"1rem"}},i.a.createElement("button",{className:"button is-primary is-active",onClick:o},"\ud83c\udf18")):i.a.createElement("div",{style:{paddingLeft:"1rem"}},i.a.createElement("button",{className:"button is-primary is-active",onClick:o},"\ud83c\udf16"))};return i.a.createElement(i.a.Fragment,null,s?i.a.createElement("nav",{className:"navigation-bar"},i.a.createElement("div",{className:"navigation-bar-contatiner"},i.a.createElement("div",{className:"navigation-bar-brand"},t),i.a.createElement(u.b,{to:"/"},i.a.createElement("button",{className:"button is-primary is-active"},"Records")),i.a.createElement(l,null)),i.a.createElement("div",{className:"navigation-bar-version"},i.a.createElement("a",{href:"https://github.com/tracits/rodant/blob/master/CHANGELOG.md"},"Built with Rodant (v.",n,")"))):null)};var fe=function(e){var t=e.db,n=e.codebook,a=e.config;return i.a.createElement(u.a,{basename:"../rodant-demo"},i.a.createElement(pe,{name:a.name,version:de.version}),i.a.createElement("div",{className:"container"},i.a.createElement(d.b,{path:"/",exact:!0,component:function(){return i.a.createElement(ue,{db:t,codebook:n,config:a})}}),i.a.createElement(d.b,{path:"/record/:uid",component:function(e){return i.a.createElement($,{db:t,codebook:n,uid:e.match.params.uid,config:a})}}),i.a.createElement(d.b,{path:"/complete/:uid",component:function(e){return i.a.createElement($,{db:t,codebook:n,uid:e.match.params.uid,"double-entry":"true",config:a})}})))},me=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function he(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ve=n(68),be=n.n(ve),ge=n(69);function ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(-1!==n.indexOf(e))return[];n.push(e);var a=/([a-z_]+[0-9]*)/g,r={};return"yes"===e.calculated&&e.equation.match(a).forEach((function(e){return r[e]=t(e)})),e.logic_checks&&e.logic_checks.match(a).forEach((function(e){return r[e]=t(e)})),Object.values(r)}function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(-1===t.indexOf(e)){t.push(e);var n,a=Object(p.a)(e.directDependencies);try{for(a.s();!(n=a.n()).done;){var r=n.value;ke(r,t)}}catch(o){a.e(o)}finally{a.f()}return t}}function Ee(e){for(var t=e[0],n=[],a=1;a<e.length;a++){for(var r={},o=0;o<t.length;o++)r[t[o]]=e[a][o];n.push(r)}for(var c=0,i=n;c<i.length;c++){var s=i[c];s.directDependencies=ye(s,(function(e){return n.find((function(t){return t.name===e}))}))}for(var l=0,u=n;l<u.length;l++){var d=u[l];d.dependencies=ke(d)}return n}!function(e){if("serviceWorker"in navigator){if(new URL("../rodant-demo",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("../rodant-demo","/service-worker.js");me?(!function(e,t){fetch(e).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):he(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):he(t,e)}))}}();function we(){return(we=Object(o.a)(r.a.mark((function e(){var t,a,o,c,s,u,d,p,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("../rodant-demo","/config.json"));case 2:return t=e.sent,e.next=5,t.json();case 5:return a=e.sent,e.next=8,fetch("".concat("../rodant-demo","/").concat(a.codebook));case 8:return o=e.sent,e.next=11,o.text();case 11:return c=e.sent,e.next=14,be.a.parse(c);case 14:return s=e.sent,u=Ee(s),d=new ge.a(a.table),p="++uid, locked, "+u.map((function(e){return e.name})).join(", "),f={records:p},d.version(1).stores(f),l.a.render(i.a.createElement(fe,{codebook:u,db:d,config:a}),document.getElementById("root")),e.next=23,n.e(0).then(n.t.bind(null,129,3));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){we.apply(this,arguments)}()},67:function(e){e.exports=JSON.parse('{"name":"rodant","version":"1.0.10","private":true,"dependencies":{"@types/jest":"^26.0.15","@types/node":"^14.14.2","@types/react":"^16.9.53","@types/react-dom":"^16.9.8","@types/react-router-dom":"^5.1.6","async-csv":"^2.1.1","bulma":"^0.7.5","csv":"^5.1.1","dexie":"^2.0.4","font-awesome":"^4.7.0","lodash":"^4.17.20","moment":"^2.24.0","react":"^16.8.6","react-dom":"^16.8.6","react-file-picker":"^0.0.6","react-helmet":"^5.2.1","react-router":"^5.0.0","react-router-dom":"^5.0.0","react-scripts":"3.2.0","typescript":"^4.0.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","prettier":"prettier \\"**/*.{json,md,scss,yaml,yml,ts,js}\\"","demo":"./deploy_demo.sh"},"eslintConfig":{"extends":["react-app"],"rules":{"no-new-func":"off","no-loop-func":"off"},"parserOptions":{"sourceType":"module"}},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"eslint":"7.12.1","prettier":"2.1.2"}}')},70:function(e,t,n){e.exports=n(128)},78:function(e,t,n){},79:function(e,t,n){}},[[70,2,3]]]);
//# sourceMappingURL=main.dc3058e6.chunk.js.map